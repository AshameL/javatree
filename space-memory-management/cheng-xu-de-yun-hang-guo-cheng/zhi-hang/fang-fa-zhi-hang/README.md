# 方法执行

java经常被称为一门解释性编程语言，但是在Hotspot中，除了实现基本的**解释器**供解释执行之外，还可以对运行是程序执行频繁的的代码进行优化，将其编译成机器吗，这部分"频繁"执行的代码称为“热点“代码，Hotspot虚拟机也由此得名。而执行编译任务的组件称为**即时编译器（Just In Time Complier，即JIT编译器）**

下文将从虚拟机基础着手，从编程语言的抽象层面对编译和解释进行介绍

## 1、虚拟机基础

要理解"虚拟机"，首先要讨论“机器“的含义，“机器“的含义与讨论时所站的角度有关。

从执行用户程序的**进程角度**看，“机器“由分配给进程的逻辑内存地址空间、用户级寄存器和允许执行进程代码的指令组成。机器的I/O部分只能通过操作系统看到，进程与I/O系统交互的唯一方法是通过操作系统调用，通常是将系统库函数作为进程的一部分来执行。所以从进程的角度看，机器由**操作系统**与底层的**用户级硬件**组合而成

从**操作系统**的角度看，整个系统由底层机器支撑。一个系统是一个完整的运行环境，可以同时支持多个不同的用户进程，所有进程共享一个文件系统和其他的I/O资源。系统为进程分配物理内存和I/O资源，允许进程通过操作系统与分配给它们的资源交互。因此，从系统的角度看，机器仅由**底层硬件实现**

![&#x7A0B;&#x5E8F;&#x548C;&#x7CFB;&#x7EDF;&#x89D2;&#x5EA6;&#x7684;&#x201C;&#x673A;&#x5668;&#x201D;](../../../../.gitbook/assets/image%20%2830%29.png)

对机器可以从进程和系统角度去理解，相应地也就有**进程级**和**系统级**虚拟机

### 1.1 进程虚拟机

顾名思义，一台进程虚拟机能够支持一个独立的进程，虚拟软件同时仿真**用户级指令**和**操作系统调用**，即上图左边机器与应用程序的边界，下图是进程虚拟机的示例

![&#x8FDB;&#x7A0B;&#x865A;&#x62DF;&#x673A;&#xFF08;&#x300A;&#x865A;&#x62DF;&#x673A;&#x7CFB;&#x7EDF;&#x4E0E;&#x8FDB;&#x7A0B;&#x7684;&#x901A;&#x7528;&#x5E73;&#x53F0;&#x300B;&#xFF09;](../../../../.gitbook/assets/image%20%2835%29.png)

术语上，我们通常将底层平台称为**主机**，将运行在虚拟机环境上的软件称为**客户机**，虚拟软件经常被称为**运行时**（runtime software），运行时用户支持客户进程，运行在操作系统的上层。虚拟机为客户进程的执行和终止提供相应的支持，**高级语言虚拟机\(如jvm\)**就是进程虚拟机的一种

### 1.2 系统虚拟机

与进程虚拟机大不相同，**系统虚拟机**提供完成的系统环境，这个环境可以支持操作洗系统及现在的许多用户进程，它使客户操作系统能够访问底层的硬件资源，包括网络、I/O以及图形用户界面

系统虚拟机如下图所示，虚拟软件（也被称为虚拟机监视器，VMM）被放在底层硬件机器和传统软件之间，虚拟软件将一个硬件平台上的指令集翻译成另一个，以构成系统虚拟机，能够执行为不同硬件集开发的系统软件环境，我们比较常见的virtual box、vmware就是这类虚拟软件

![&#x7CFB;&#x7EDF;&#x865A;&#x62DF;&#x673A;](../../../../.gitbook/assets/image%20%2837%29.png)

以上简单介绍了虚拟机的两种分类：进程虚拟机和系统虚拟机，接下来重点介绍进程虚拟机中比较特殊的一类：高级语言虚拟机

### **1.3 高级语言虚拟机**

一个高级语言虚拟机与传统的进程虚拟机是类似的，但是这种场景的指令系统\(ISA\)仅仅是为用户模式的程序定义的，**并不是针对一个真实的硬件处理器**而设计的，它将仅仅在一个虚拟机的处理器上执行，因此也被称为**虚拟指令系统**（V-ISA）

![&#x4F20;&#x7EDF;&#x7684;&#x7F16;&#x8BD1;&#x3001;&#x52A0;&#x8F7D;&#x4E0E;&#x9AD8;&#x7EA7;&#x8BED;&#x8A00;&#x865A;&#x62DF;&#x673A;&#x4E2D;&#x56FD;&#x5462;&#x7684;&#x7F16;&#x8BD1;&#x3001;&#x52A0;&#x8F7D;](../../../../.gitbook/assets/image%20%2834%29.png)

我们可以从语言/编译器的角度来看待高级语言虚拟机，从



### 2、编译器和解释器的基本结构

对于一个编译器，它的主要目的在于将**源代码**编译成**目标代码**，中间会经过词法分析、语法分析等许多步骤，具体流程可以看下图，以C语言为例的话就是将C原文件编译成了汇编代码，

![&#x7F16;&#x8BD1;&#x6D41;&#x7A0B;](../../../../.gitbook/assets/image%20%2833%29.png)



