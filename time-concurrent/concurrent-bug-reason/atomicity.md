一个或者多个操作在 CPU 执行的过程中不被中断的特性，称为原子性。但是CPU线程切换会导致原子性被破坏。

线程切换是操作系统对多任务执行所做的优化。起初针对进程切换时间片，后来出现了更细粒度的线程概念，将线程作为CPU调度的基本单位。但是高级语言中的一条指令常需要多条 CPU 指令完成，例如简单的 `count ++`，至少需要三条 CPU 指令：

1. 把变量 count 从内存加载到 CPU 的寄存器；
2. 在寄存器中执行 +1 操作；
3. 将结果写入内存（缓存机制导致可能写入的是 CPU 缓存而不是内存）。

但是CPU可能在任意一条CPU指令执行完成后切换时间片，造成高级语言的一条指令并不原子执行。本地内存导致的可见性问题